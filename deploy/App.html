<!DOCTYPE html>
<html>
<head>
    <title>HelloWorld</title>

    <script type="text/javascript" src="/apps/2.0rc3/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",items:{html:'<a href="https://help.rallydev.com/apps/2.0rc3/doc/">App SDK 2.0rc3 Docs</a>'},launch:function(){this.topContainer=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"left",padding:10}}),this.add(this.topContainer),this._loadIndustryEpicData()},_loadIndustryEpicData:function(){this.myStore?this.myStore.load():this.myStore=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/Epic",fetch:["Name","State","FormattedID","Owner","Tags","RefinedEstimate","c_TargetLaunch"],autoLoad:!0,context:{workspace:"/workspace/1089940415",project:"/project/11656855707",projectScopeUp:!1,projectScopeDown:!0},listeners:{load:function(myStore,data,success){this._loadEpicComboData(data)},scope:this},sorters:[{property:"FormattedID",direction:"ASC"}]})},_loadEpicComboData:function(industryEpicLoadData){var epicComboStore=this._createAllEpicComboStore(industryEpicLoadData);this.epicSelector=Ext.create("Ext.form.ComboBox",{fieldLabel:"Select Epics: ",itemId:"industryEpicCombobox",store:epicComboStore,queryMode:"local",displayField:"Name",valueField:"ID",width:600,listeners:{select:this._onEpicComboSelect,ready:this._onEpicComboLoad,scope:this}}),this.topContainer.add(this.epicSelector)},_onEpicComboLoad:function(){},_onEpicComboSelect:function(){var selectedEpic=this.down("#industryEpicCombobox").getValue();console.log("Selected value?",selectedEpic),this._loadSelectedEpicDetailsFromStore(selectedEpic)},_loadSelectedEpicDetailsFromStore:function(selectedEpicId){var thisFilter={property:"FormattedID",value:selectedEpicId};this.myEpicStore?(console.log("My Epic store exists."),this.myEpicStore.setFilter(thisFilter),this.myEpicStore.load()):this.myEpicStore=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/Epic",fetch:["Name","State","FormattedID","Owner","Tags","RefinedEstimate","c_TargetLaunch"],autoLoad:!0,context:{workspace:"/workspace/1089940415",project:"/project/11656855707",projectScopeUp:!1,projectScopeDown:!0},listeners:{load:function(myEpicStore,epicData,success){this._loadEpicDetailsPanel(epicData)},scope:this},sorters:[{property:"FormattedID",direction:"ASC"}],filters:[thisFilter]})},_loadEpicDetailsPanel:function(selectedEpicData){console.log("selected epic data?",selectedEpicData);var epicName=selectedEpicData[0].get("Name"),ownerName=null!==selectedEpicData[0].get("Owner")?null!==selectedEpicData[0].get("Owner")._refObjectName?selectedEpicData[0].get("Owner")._refObjectName:"No Owner":"No Owner",refinedEstimate=selectedEpicData[0].get("RefinedEstimate"),targetLaunch=null!==selectedEpicData[0].get("c_TargetLaunch")?""+selectedEpicData[0].get("c_TargetLaunch"):"No Target Specified";this.epicDetailPanel?(console.log("update existing panel."),this.epicDetailPanel.getForm().findField("name").setValue(epicName),this.epicDetailPanel.getForm().findField("owner").setValue(ownerName),this.epicDetailPanel.getForm().findField("refined_estimate").setValue(refinedEstimate),this.epicDetailPanel.getForm().findField("target_launch").setValue(targetLaunch)):(console.log("create new panel."),this.epicDetailPanel=Ext.create("Ext.form.Panel",{renderTo:Ext.getBody(),width:500,height:150,layout:{type:"vbox",align:"stretch",padding:10},title:"Epic Details",items:[{xtype:"displayfield",fieldLabel:"Name",name:"name",value:epicName},{xtype:"displayfield",fieldLabel:"Owner",name:"owner",value:ownerName},{xtype:"displayfield",fieldLabel:"Refined Estimate",name:"refined_estimate",value:refinedEstimate},{xtype:"displayfield",fieldLabel:"Target Launch",name:"target_launch",value:targetLaunch}]}),this.topContainer.add(this.epicDetailPanel))},_createAllEpicComboStore:function(industryEpicLoadData){Ext.define("Epic",{extend:"Ext.data.Model",fields:[{name:"ID",type:"string"},{name:"Name",type:"string"}]});var epicDataCol=[];Ext.Array.each(industryEpicLoadData,function(thisIndustryEpic){var epicName=thisIndustryEpic.get("Name"),epicId=thisIndustryEpic.get("FormattedID"),epicComboName=epicId+": "+epicName,epicData=Ext.create("Epic",{ID:epicId,Name:epicComboName});epicDataCol.push(epicData)});var epicComboStore=Ext.create("Ext.data.Store",{model:"Epic",data:epicDataCol,autoLoad:!0});return epicComboStore}});

            Rally.launchApp('CustomApp', {
                name:"HelloWorld",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body></body>
</html>
