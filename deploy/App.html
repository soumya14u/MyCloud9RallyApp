<!DOCTYPE html>
<html>
<head>
    <title>HelloWorld</title>

    <script type="text/javascript" src="/apps/2.0rc3/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",items:{html:'<a href="https://help.rallydev.com/apps/2.0rc3/doc/">App SDK 2.0rc3 Docs</a>'},industryEpicStore:void 0,epicComboStore:void 0,selectedIndustryEpicID:void 0,selectedIndustryEpicData:void 0,launch:function(){this.topContainer=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"left",padding:10}}),this.add(this.topContainer),this._loadIndustryEpicDataStore()},_loadIndustryEpicDataStore:function(){this.industryEpicStore?this.industryEpicStore.load():this.industryEpicStore=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/Epic",fetch:["Name","State","FormattedID","Owner","Tags","RefinedEstimate","c_TargetLaunch"],autoLoad:!0,context:{workspace:"/workspace/1089940415",project:"/project/11656855707",projectScopeUp:!1,projectScopeDown:!0},listeners:{load:function(myStore,data,success){this._loadEpicComboBox()},scope:this},sorters:[{property:"FormattedID",direction:"ASC"}]})},_loadEpicComboBox:function(){this.industryEpicStore&&(this._createAllEpicComboStore(this.industryEpicStore.getRecords()),this.epicComboStore&&(this.epicSelector=Ext.create("Ext.form.ComboBox",{fieldLabel:"Select Epics: ",itemId:"industryEpicCombobox",store:this.epicComboStore,queryMode:"local",displayField:"Name",valueField:"ID",width:600,listeners:{select:this._onEpicComboBoxSelect,ready:this._onEpicComboBoxLoad,scope:this}}),this.topContainer.add(this.epicSelector)))},_onEpicComboBoxLoad:function(){},_onEpicComboBoxSelect:function(){this.selectedIndustryEpicID=this.down("#industryEpicCombobox").getValue(),console.log("Selected value?",this.selectedIndustryEpicID),this._loadSelectedEpicDetailsFromStore()},_loadSelectedEpicDetailsFromStore:function(){if(this.industryEpicStore&&this.selectedIndustryEpicID){var records=this.industryEpicStore.getRecords(),index=this.industryEpicStore.find("FormattedID",this.selectedIndustryEpicID);this.selectedIndustryEpicData=records[index],console.log("Selected records from my Store",this.selectedIndustryEpicData),this._loadEpicDetailsPanel()}},_loadEpicDetailsPanel:function(){if(this.selectedIndustryEpicData){console.log("selected epic data?",this.selectedIndustryEpicData);var epicName=this.selectedIndustryEpicData.get("Name"),ownerName=null!==this.selectedIndustryEpicData.get("Owner")?null!==this.selectedIndustryEpicData.get("Owner")._refObjectName?this.selectedIndustryEpicData.get("Owner")._refObjectName:"No Owner":"No Owner",refinedEstimate=this.selectedIndustryEpicData.get("RefinedEstimate"),targetLaunch=null!==this.selectedIndustryEpicData.get("c_TargetLaunch")?""+this.selectedIndustryEpicData.get("c_TargetLaunch"):"No Target Specified";this.epicDetailPanel?(console.log("update existing panel."),this.epicDetailPanel.getForm().findField("name").setValue(epicName),this.epicDetailPanel.getForm().findField("owner").setValue(ownerName),this.epicDetailPanel.getForm().findField("refined_estimate").setValue(refinedEstimate),this.epicDetailPanel.getForm().findField("target_launch").setValue(targetLaunch)):(console.log("create new panel."),this.epicDetailPanel=Ext.create("Ext.form.Panel",{renderTo:Ext.getBody(),width:500,height:150,layout:{type:"vbox",align:"stretch",padding:10},title:"Epic Details",items:[{xtype:"displayfield",fieldLabel:"Name",name:"name",value:epicName},{xtype:"displayfield",fieldLabel:"Owner",name:"owner",value:ownerName},{xtype:"displayfield",fieldLabel:"Refined Estimate",name:"refined_estimate",value:refinedEstimate},{xtype:"displayfield",fieldLabel:"Target Launch",name:"target_launch",value:targetLaunch}]}),this.topContainer.add(this.epicDetailPanel))}},_createAllEpicComboStore:function(){if(this.industryEpicStore){Ext.define("Epic",{extend:"Ext.data.Model",fields:[{name:"ID",type:"string"},{name:"Name",type:"string"}]});var epicDataCol=[];Ext.Array.each(this.industryEpicStore.getRecords(),function(thisIndustryEpic){var epicName=thisIndustryEpic.get("Name"),epicId=thisIndustryEpic.get("FormattedID"),epicComboName=epicId+": "+epicName,epicData=Ext.create("Epic",{ID:epicId,Name:epicComboName});epicDataCol.push(epicData)}),this.epicComboStore=Ext.create("Ext.data.Store",{model:"Epic",data:epicDataCol,autoLoad:!0,listeners:{scope:this}})}}});

            Rally.launchApp('CustomApp', {
                name:"HelloWorld",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body></body>
</html>
